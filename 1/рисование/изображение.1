#!1
используется класс
  графический-интерфейс/объект
  с-префиксом rkt: racket/draw

изображение% = класс объект%
  базовый-объект()
  инициализировать
    $ширина(ширина) ложь
    $высота(высота) ложь
    $масштаб(масштаб) ложь
    файл ложь
    вид-файла 'unknown
    цвет-фона ложь
    неудачная-загрузка-ошибка? ложь
    хранить-данные-файла? ложь
    байты ложь
    $чёрно-белое?(чёрно-белое?) ложь
    прозрачность? ложь
  $внутренний =
    если
      файл
        создать-объект rkt:bitmap% файл вид-файла цвет-фона неудачная-загрузка-ошибка? $масштаб
          хранить-данные-файла?
      ($ширина && $высота)
        если байты тогда
          создать-объект rkt:bitmap% байты $ширина $высота
          иначе
          создать-объект rkt:bitmap% $ширина $высота $чёрно-белое? прозрачность? $масштаб
      иначе
        ошибка 'изображение% «аргументы инициализации «ширина» и «высота» обязательны»
        
  внутренний() = $внутренний
  пиксели-в-байты лево верх ширина высота байты-пикселей
    только-прозрачность? ложь
    учитывать-прозрачность? ложь
    #:без-масштаба? без-масштаба? ложь
    =
    $внутренний{get-argb-pixels лево верх ширина высота байты-пикселей
                                только-прозрачность? учитывать-прозрачность?
                                #:без-масштаба? без-масштаба?}
  масштаб() = $внутренний{get-backing-scale}
  данные-файла() = $внутренний{get-data-from-file}
  глубина-цвета() = $внутренний{get-depth}
  указатель() = $внутренний{get-handle}
  высота() = $внутренний{get-height}
  загруженная-маска = функция-выбора
    () $внутренний{get-loaded-mask}
    (значение) $внутренний{set-loaded-mask значение}
  ширина() = $внутренний{get-width}
  есть-прозрачность?() = $внутренний{has-alpha-channel?}
  чёрно-белое?() =
    не $внутренний{is-color?}
  загрузить-файл файл
    вид-файла 'unknown
    цвет-фона ложь
    неудачная-загрузка-ошибка? ложь
    #:хранить-данные-файла? хранить-данные-файла? ложь
    =
    $внутренний{load-file файл вид-файла цвет-фона неудачная-загрузка-ошибка?
                          #:хранить-данные-файла? хранить-данные-файла?}
  среда-рисования() = $внутренний{make-dc}
  работает?() = $внутренний{ok?}
  записать-файл файл вид-файла
    качество 75
    без-масштаба? ложь
    =
    $внутренний{save-file файл вид-файла качество без-масштаба?}
  байты-в-пиксели лево верх ширина высота байты-пикселей
    только-прозрачность? ложь
    учитывать-прозрачность? ложь
    #:без-масштаба? без-масштаба? ложь
    =
    $внутренний{set-argb-pixels лево верх ширина высота байты-пикселей
                                только-прозрачность? учитывать-прозрачность?
                                #:без-масштаба? без-масштаба?}
    