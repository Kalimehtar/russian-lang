#!1
используется класс
  с-префиксом rkt: racket/gui
предоставлять главное-окно% текстовое-поле% объект

область<%> = интерфейс () родитель главное-окно минимальная-ширина минимальная-высота \
    минимальные-размеры-вывода растягивается-ширина растягивается-высота

окно<%> = интерфейс (область<%>) принимать-файлы окно->экран экран->окно включить сфокусировать \
    размеры указатель курсор высота заголовок ширина внутренние-размеры показать лево верх \
    есть-фокус? включено? показано? при-получении-файла при-изменении-фокуса при-перемещении \
    при-изменении-размера при-получении-элементом-клавиши при-получении-элементом-события \
    при-изменении-фокуса-элемента при-активации-содержащего-окна при-включении-содержащего-окна \
    при-показывании-содержащего-окна обновить переместить-курсор контекстное-меню \
    режим-колеса-мыши

главное-окно<%> = интерфейс (окно<%>)

определение-синтаксического-правила метод-выбора($внутренний имя)
  функция-выбора
    () $внутренний{имя}
    (новое-значение) $внутренний{имя новое-значение}

определение-синтаксического-правила по-шаблону(тело)
  пусть ()
    определение-синтаксиса (одноразовый форма)
      выбор-синтаксиса форма ()
        (_) тело
    одноразовый()

при-компиляции
  события-окна = '
    on-drop-file путь = получатель-событий{при-получении-файла путь}
    on-focus есть-фокус? = получатель-событий{при-изменении-фокуса есть-фокус?}
    on-move лево верх = получатель-событий{при-перемещении лево верх}
    on-size ширина высота = получатель-событий{при-изменении-размера ширина высота}
    on-subwindow-char элемент событие =
      получатель-событий{при-получении-элементом-клавиши поле(получатель-событий элемент) событие}
    on-subwindow-event элемент событие =
      получатель-событий{при-получении-элементом-события поле(получатель-событий элемент) событие}
    on-subwindow-focus элемент есть-фокус? =
      получатель-событий{при-изменении-фокуса-элемента поле(получатель-событий элемент) есть-фокус?}
    on-superwindow-activate активно? = получатель-событий{при-активации-содержащего-окна активно?}
    on-superwindow-enable включено? = получатель-событий{при-включении-содержащего-окна включено?}
    on-superwindow-show показано? = получатель-событий{при-показывании-содержащего-окна показано?}
  методы-области = '
    родитель() = $родитель
    минимальная-ширина =
      метод-выбора $внутренний min-width
    минимальная-высота =
      метод-выбора $внутренний min-height
    минимальные-размеры-вывода() = $внутренний{get-graphical-min-size}
    растягивается-ширина =
      метод-выбора $внутренний stretchable-width
    растягивается-высота =
      метод-выбора $внутренний stretchable-height
  инициализация-области = '
    $минимальная-ширина(минимальная-ширина) ложь
    $минимальная-высота(минимальная-высота) ложь
    $растягивается-ширина(растягивается-ширина) истина
    $растягивается-высота(растягивается-высота) истина
  внутренняя-инициализация-области = '
    min-width $минимальная-ширина
    min-height $минимальная-высота    
    stretchable-width $растягивается-ширина
    stretchable-height $растягивается-высота  
  методы-окна = '
    заголовок = функция-выбора
      () $внутренний{get-label}
      (новое-значение) $внутренний{set-label новое-значение}
    ширина() = $внутренний{get-width}
    высота() = $внутренний{get-height}
    показать состояние = $внутренний{show состояние}
    включить состояние = $внутренний{enable состояние}
    указатель() = $внутренний{get-handle}
    курсор = функция-выбора
      () $внутренний{get-cursor}
      (новое-значение) $внутренний{set-cursor новое-значение}
    принимать-файлы = метод-выбора($внутренний accept-drop-files)
    окно->экран лево верх = $внутренний{client->screen лево верх}
    экран->окно лево верх = $внутренний{screen->screen лево верх}
    лево() = $внутренний{get-x}
    верх() = $внутренний{get-y}
    обновить() = $внутренний{refresh}
    есть-фокус?() = $внутренний{has-focus?}
    включено?() = $внутренний{is-enabled?}
    показано?() = $внутренний{is-shown?}
    внутренние-размеры() = $внутренний{get-client-size}
    размеры() = $внутренний{get-size}
    сфокусировать() = $внутренний{focus}
    переместить-курсор лево верх = $внутренний{warp-pointer лево верх}
    контекстное-меню меню лево верх = $внутренний{popup-menu лево верх}
    режим-колеса-мыши = функция-выбора
      ()
        выбор $внутренний{wheel-event-mode}
          (one) 'по-одному
          (integer) 'по-целым
          (fraction) 'сразу
      (новое-значение)
        новое-значение* = выбор новое-значение
          (по-одному) 'one
          (по-целым) 'integer
          (сразу) 'fraction
        $внутренний{wheel-event-mode новое-значение*}
    -- события окно<%>
    при-получении-файла путь = пусто
    при-изменении-фокуса есть-фокус? = пусто
    при-перемещении лево верх = пусто
    при-изменении-размера ширина высота = пусто
    при-получении-элементом-клавиши элемент событие = ложь
    при-получении-элементом-события элемент событие = ложь
    при-изменении-фокуса-элемента элемент есть-фокус? = пусто
    при-активации-содержащего-окна активно? = пусто
    при-включении-содержащего-окна включено? = пусто
    при-показывании-содержащего-окна показано? = пусто
  имя-метода элемент =
    имя = первый $ оставшиеся элемент
    список? имя ?
      первый имя
      имя
    
внутренний-главного-окна% = по-шаблону $ #` класс rkt:frame%
  базовый-объект()
  инициализированные-поля получатель-событий
  переопределить #,@(отобразить имя-метода события-окна)
  #,@события-окна

главное-окно% = по-шаблону $ #` класс* объект% (главное-окно<%>)
  базовый-объект()
  методы внутренний главное-окно #,@(отобразить имя-метода $ методы-области ++ методы-окна)
  инициализировать
    $заголовок(заголовок) ""
    $ширина(ширина) ложь
    $высота(высота) ложь
    #,@инициализация-области
  инициализированные-поля
    $родитель(родитель) ложь 
  $внутренний = объект внутренний-главного-окна%
    получатель-событий этот
    parent $ $родитель ? $родитель{внутренний} ложь
    label $заголовок
    width $ширина
    height $высота
    #,@внутренняя-инициализация-области
  внутренний() = $внутренний
  -- область<%>
  главное-окно() = этот
  #,@методы-области
  -- окно<%>
  #,@методы-окна
  
внутренний-текстового-поля% = по-шаблону $ #` класс rkt:text-field%
  базовый-объект()
  инициализированные-поля получатель-событий
  переопределить #,@(отобразить имя-метода события-окна)
  #,@события-окна

текстовое-поле% = по-шаблону $ #` класс* объект% ()
  базовый-объект()
  методы внутренний #,@(отобразить имя-метода $ методы-области ++ методы-окна)
  инициализированные-поля
    $родитель(родитель)()
  инициализировать
    $заголовок(заголовок) ложь
    #,@инициализация-области
  $внутренний = объект внутренний-текстового-поля%
    получатель-событий этот
    parent $родитель{внутренний}
    label $заголовок
    #,@внутренняя-инициализация-области
  внутренний() = $внутренний
  -- область<%>
  главное-окно() = $родитель{главное-окно}
  #,@методы-области
  -- окно<%>
  #,@методы-окна
